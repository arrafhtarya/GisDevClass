<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>ä¸­å€ç”œé»æ¨è–¦åœ°åœ–</title>
<link rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.9.0/css/ol.css">
<script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.9.0/build/ol.js"></script>
<style>
  body { font-family: "Microsoft JhengHei", sans-serif; margin:10px; }
  #map { width:100%; height:520px; border:1px solid #aaa; }
  .panel { margin-top:10px; padding:10px; border:1px solid #ccc; background:#f9f9f9; }
  button { margin:2px; }
  input[type="text"] { width:100px; }
</style>
</head>
<body>

<h2>ğŸ° ä¸­å€ç”œé»æ¨è–¦åœ°åœ–</h2>

<div id="map"></div>

<!-- æŒ‡åŒ—é‡ -->
<img src="https://upload.wikimedia.org/wikipedia/commons/e/ec/Compass_rose_pale.svg"
     style="position:absolute;top:15px;right:15px;width:60px;z-index:999;">

<div class="panel">
  <h4>ğŸ“ åœ°åœ–æ§åˆ¶</h4>
  <button onclick="GoInitView()">èµ·å§‹ä½ç½®</button>
  <button onclick="PanToCJSJ()">CJSJ</button>
  <button onclick="PanToFFN()">æ³•èŠ™å°¼</button>
  <button onclick="PanToFBT()">æ³•å¸ƒç”œ</button>
  <button onclick="PanToHYTD()">å›æ†¶ç”œé»</button>
  <button onclick="PanToAB()">AB</button>
  <button onclick="PanToSTSUTD()">è’”åˆç”œé»</button>

  <hr>

  <h4>ğŸ“ é‡æ¸¬å·¥å…·</h4>
  <button onclick="addMeasure('LineString')">æ¸¬è·</button>
  <button onclick="addMeasure('Polygon')">æ¸¬é¢</button>

  <hr>

  <h4>ğŸ” åº§æ¨™å®šä½</h4>
  ç¶“åº¦ <input type="text" id="lon" placeholder="120.6483">
  ç·¯åº¦ <input type="text" id="lat" placeholder="24.1799">
  <button onclick="goToCoord()">å®šä½</button>

  <hr>

  <h4>ğŸ“Š åº•åœ–é€æ˜åº¦</h4>
  <input type="range" min="0" max="1" step="0.1" value="1" onchange="setOpacity(this.value)">
</div>

<script>
/* ===== åœ°åœ–åˆå§‹åŒ– ===== */
const initCenter = ol.proj.fromLonLat([120.6465,24.1788]);
const view = new ol.View({ center:initCenter, zoom:14 });
const raster = new ol.layer.Tile({ source: new ol.source.OSM() });
const map = new ol.Map({ target:"map", layers:[raster], view:view });

/* ===== ç”œé»é»ä½ ===== */
const locations = [
  { name:"CJSJ", coord:[120.6640,24.1448] },
  { name:"æ³•èŠ™å°¼", coord:[120.6643,24.1507] },
  { name:"æ³•å¸ƒç”œ", coord:[120.6524,24.1599] },
  { name:"å›æ†¶ç”œé»", coord:[120.6766,24.1641] },
  { name:"AB æ³•åœ‹äººçš„ç”œé»åº—", coord:[120.6612,24.1250] },
  { name:"è’”åˆç”œé»", coord:[120.6588,24.1250] },
];

const markerSource = new ol.source.Vector();
locations.forEach(l=>{
  markerSource.addFeature(new ol.Feature({
    geometry:new ol.geom.Point(ol.proj.fromLonLat(l.coord)),
    name:l.name
  }));
});

const markerLayer = new ol.layer.Vector({
  source:markerSource,
  style:f=>new ol.style.Style({
    image:new ol.style.Circle({
      radius:6,
      fill:new ol.style.Fill({color:"#ffcc33"}),
      stroke:new ol.style.Stroke({color:"#333", width:1})
    }),
    text:new ol.style.Text({
      text:f.get("name"),
      offsetY:-15,
      fill:new ol.style.Fill({color:"#000"}),
      stroke:new ol.style.Stroke({color:"#fff", width:3})
    })
  })
});
map.addLayer(markerLayer);

/* ===== PanTo åŠŸèƒ½ ===== */
const CJSJ = ol.proj.fromLonLat([120.6640,24.1448]);
const FFN = ol.proj.fromLonLat([120.6643,24.1507]);
const FBT = ol.proj.fromLonLat([120.6524,24.1599]);
const HYTD = ol.proj.fromLonLat([120.6766,24.1641]);
const AB = ol.proj.fromLonLat([120.6612,24.1250]);
const STSUTD = ol.proj.fromLonLat([120.6588,24.1250]);

function GoInitView(){ view.animate({center:initCenter, zoom:14, duration:1200}); }
function PanToCJSJ(){ view.animate({center:CJSJ, duration:1200}); }
function PanToFFN(){ view.animate({center:FFN, duration:1200}); }
function PanToFBT(){ view.animate({center:FBT, duration:1200}); }
function PanToHYTD(){ view.animate({center:HYTD, duration:1200}); }
function PanToAB(){ view.animate({center:AB, duration:1200}); }
function PanToSTSUTD(){ view.animate({center:STSUTD, duration:1200}); }

/* ===== æ–°å¢åŠŸèƒ½ ===== */
// é‡æ¸¬
let draw;
const measureSource = new ol.source.Vector();
const measureLayer = new ol.layer.Vector({ source: measureSource });
map.addLayer(measureLayer);
function addMeasure(type){
  map.removeInteraction(draw);
  draw = new ol.interaction.Draw({ source: measureSource, type:type });
  map.addInteraction(draw);
}

// é»æ“Šé¡¯ç¤ºåº§æ¨™
map.on('singleclick', function(evt){
  const c = ol.proj.toLonLat(evt.coordinate);
  alert(`ç¶“åº¦ï¼š${c[0].toFixed(6)}\nç·¯åº¦ï¼š${c[1].toFixed(6)}`);
});

// ç¶“ç·¯åº¦è¼¸å…¥å®šä½
function goToCoord(){
  const lon=parseFloat(document.getElementById("lon").value);
  const lat=parseFloat(document.getElementById("lat").value);
  if(isNaN(lon)||isNaN(lat)){ alert("è«‹è¼¸å…¥æ­£ç¢ºç¶“ç·¯åº¦"); return; }
  view.animate({center:ol.proj.fromLonLat([lon,lat]), zoom:16, duration:1200});
}

// åº•åœ–é€æ˜åº¦
function setOpacity(val){ raster.setOpacity(val); }

</script>
</body>
</html>
